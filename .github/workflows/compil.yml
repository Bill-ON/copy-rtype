name: Compile on UNIX

on: [push, pull_request]

jobs:
  linux:
    name: Linux-x86
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: recursive
          fetch-depth: 0
          
      - name: check where cpp is
        run: which g++

      - name: Create BUILD folder
        working-directory: ${{github.workspace}}/server
        run: mkdir build
        
      - name: Configure Server
        working-directory: ${{github.workspace}}/server
        run: cmake -S . -B ${{github.workspace}}/build -DCMAKE_TOOLCHAIN_FILE=${{github.workspace}}/vcpkg/scripts/buildsystems/vcpkg.cmake
        continue-on-error: true
        
      - name: delete Cache
        working-directory: ${{github.workspace}}/server/build
        run: rm -rf CMakeCache.txt
        
      - name: reload Server cache
        working-directory: ${{github.workspace}}/server
        run: cmake -S . -B ${{github.workspace}}/build -DCMAKE_TOOLCHAIN_FILE=${{github.workspace}}/vcpkg/scripts/buildsystems/vcpkg.cmake
        continue-on-error: true
        
      - name: Build Server
        working-directory: ${{github.workspace}}/server
        run: cmake --build ./build/
